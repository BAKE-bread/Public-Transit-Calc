# **形式化定义最优调度模型**
### 三段换乘系统的离散相位偏移优化模型

---

## 一、参数与变量

* $T_1, T_2, T_3 > 0$：三条线路的固定发车周期。
* $\delta_2 \in [0, T_2),\;\delta_3 \in [0, T_3)$：线路 L2、L3 的发车相位偏移量（待优化）。
* $N = \dfrac{\mathrm{LCM}(T_1,T_2,T_3)}{T_1}$：在一个公共周期内，L1 的发车班次数目。

---

## 二、离散发车时刻

令

$$
t_{A,k} \;=\; k\,T_1,
\quad k = 1,2,\dots,N
$$

表示第 $k$ 趟 L1 班次的发车时刻。

> 对于通用的 N 段换乘系统，可使用递归定义的到达时刻与等待时间。

---

## 三、模运算定义

对于任意实数 $x$ 和正周期 $T$，定义

$$
x \bmod T \;=\; x - T\cdot\left\lfloor \frac{x}{T} \right\rfloor,
$$

其值落在区间 $[0, T)$。

---

## 四、等待时间函数

1. **L2 等待时间**

   $$
   W_{2,k}(\delta_2)
   \;=\;
   \bigl(\,\delta_2 - t_{A,k}\bigr)\bmod T_2.
   $$

2. **到达 L3 站的时刻**

   $$
   t_{B,k}' \;=\; t_{A,k} + W_{2,k}(\delta_2).
   $$

3. **L3 等待时间**

   $$
   W_{3,k}(\delta_2,\delta_3)
   \;=\;
   \bigl(\,\delta_3 - t_{B,k}'\bigr)\bmod T_3.
   $$

---

## 五、期望等待时间

* **第一段**（L1）假设乘客随机到达，

  $$
  E[W_1] \;=\; \frac{T_1}{2}.
  $$

* **第二段**（L2）平均等待

  $$
  E[W_2](\delta_2)
  \;=\;
  \frac{1}{N}
  \sum_{k=1}^N
  W_{2,k}(\delta_2).
  $$

* **第三段**（L3）平均等待

  $$
  E[W_3](\delta_2,\delta_3)
  \;=\;
  \frac{1}{N}
  \sum_{k=1}^N
  W_{3,k}(\delta_2,\delta_3).
  $$

* **总期望等待**

  $$
  E_{\mathrm{total}}(\delta_2,\delta_3)
  \;=\;
  E[W_1] \;+\; E[W_2](\delta_2) \;+\; E[W_3](\delta_2,\delta_3).
  $$

---

## 六、优化目标

$$
(\delta_2^*,\,\delta_3^*)
=\;\underset{0\le \delta_2< T_2,\;0\le \delta_3< T_3}{\arg\min}\;
E_{\mathrm{total}}(\delta_2,\delta_3).
$$

对应的最小总等待时间为
$\displaystyle E_{\mathrm{total}}^* = E_{\mathrm{total}}(\delta_2^*,\delta_3^*)$.

---

> **模型含义**：
> 通过枚举并计算两段线路的相位偏移 $(\delta_2,\delta_3)$ 对乘客总等待时间的影响，找出能使三段换乘平均总等待最小的调度参数。



# 关于最优换乘调度中 $\delta \approx 0$ 的现象解释

在多级换乘调度优化问题中，我们经常观察到发车时刻偏移量（$\delta$）趋近于零是最优解之一。这种现象并非偶然，也不是算法陷入局部极小，而是该类系统在特定条件下所呈现出的**结构性最优性**。本文尝试从数学角度对这一现象进行形式化解释，重点引入“**班期公约数效应**”与“**系统原点对齐优势**”。

## 1. 问题定义与符号

考虑如下系统：

* L1：公交线路，周期为 $T_1$；
* L2：接驳公交线路，周期为 $T_2$，首班车相对于全局时钟的发车偏移为 $\delta$；
* $t_k$：第 $k$ 位乘客从 L1 到达换乘点的时刻；
* $W_k(\delta)$：该乘客在 $\delta$ 条件下的等待时间；
* 优化目标：寻找 $\delta^*$ 使平均等待时间最小，即
    $$
    \delta^* = \arg\min_{\delta \in [0, T_2)} \frac{1}{K} \sum_{k=1}^K W_k(\delta)
    $$

## 2. 班期公约数效应（Common Divisor Effect）

设 $T_1, T_2$ 为正整数或可近似为整数，定义 $g = \gcd(T_1, T_2)$。

### 命题 1：

当 $g > 1$ 时，乘客到达时刻 $\{t_k\}$ 在模 $T_2$ 的时钟中不会均匀分布，而是仅落入离散的余数集合中。

**证明（概略）：**

设 L1 的出发时刻为 $t = 0$，周期为 $T_1$，则 $t_k = kT_1$，则：
$$
t_k \bmod T_2 = (kT_1) \bmod T_2
$$
由于 $\gcd(T_1, T_2) = g$，故 $(kT_1) \bmod T_2$ 的值仅可能落入 $\frac{T_2}{g}$ 个等间隔的类中，构成一个余数子群：
$$
\mathcal{R} = \{ (kT_1')g \bmod T_2 \mid k \in \mathbb{Z} \}, \quad \text{其中 } T_1' = \frac{T_1}{g}
$$

**例子：**

* $T_1 = 6$, $T_2 = 10$, $g = 2$
* 乘客到达时刻模 10 为 $\{0, 2, 4, 6, 8\}$，只占 $[0, 10)$ 中的一半。

**结论：** $\delta$ 的优化目标只需在有限多个候选点的“后侧邻近”进行尝试。

## 3. 自然零偏移优势（Phase-0 Locking）

在这种非均匀模分布下，$\delta = 0$ 具有天然的结构优势，原因如下：

* **0作为特征余数集合的元素**：由于某些到达点正好为 $0 \bmod T_2$，$\delta = 0$ 能使此类乘客实现“无等待”换乘；
* **相位对齐效应**：$\delta = 0$ 对应于 L2 时刻表的“系统原点”，在许多自然周期系统中，这种“无相移状态”具有更小的整体相对等待；
* **遗传/优化算法特性**：$\delta = 0$ 是搜索空间中极易访问的边界点，在周期性目标函数中常作为局部极小的候选。

## 4. 多级换乘中的锁定传播（Resonance Locking Propagation）

若 L2 的最优 $\delta_2^* \approx 0$，则其乘客出发时间序列 $t'_k = t_k + W_k(\delta_2^*)$ 仍将保留来自 $T_1, T_2$ 的模分布特征，因而：

* $\delta_3$ 的优化问题中，$t'_k \bmod T_3$ 的结构性仍然显著；
* 导致下一级最优 $\delta_3^* \approx 0$ 的概率继续升高；
* 形成“**多级时间对齐结构锁定（multi-level temporal phase locking）**”。

## 5. 什么时候 $\delta = 0$ 不再最优？

当：

* $T_1$ 与 $T_2$ **互素**，即 $\gcd(T_1, T_2) = 1$；
* 或 $T_2$ 为非整数（如 $T_2 = 10.1$），破坏了余数群的整齐结构；
* 或 L1 的出发间隔不为定值，导致 $\{t_k\}$ 近似均匀覆盖 $[0, T_2)$。

此时 $\{t_k \bmod T_2\}$ 更近似于连续均匀分布，$\delta = 0$ 失去结构优势，最优解更可能为非零浮点数。

---

## 总结

“$\delta \approx 0$ 最优”是周期性调度系统中一种**内在谐波共振结构的自然结果**。当系统周期存在公共因子，乘客的到达时刻在目标周期空间中呈现非均匀、结构化分布，此时“系统原点对齐”的发车时刻表会以结构性方式最小化等待。该现象不仅是优化算法正确性的体现，更揭示了调度系统中可利用的数学对称性与周期耦合规律。